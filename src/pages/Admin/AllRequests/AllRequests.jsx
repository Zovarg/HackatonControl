import React, {useEffect, useState} from 'react';
import cl from './AllRequests.module.css'
import Builders from "../../../images/Builders.svg";
import AvatarRequest from "../../../images/AvatarRequest.svg";
import {useFetching} from "../../../hooks/useFetching";
import api from "../../../services/api";
import jwt from "jwt-decode";
const AllRequests = ({page, setPage}) => {
    const [titles, setTitles]=useState([
        {name:'Все заявки'},
        {name:'Канбан'},
        {name:'Бизнес-центры'},
        {name:'ЖК'},
        {name:'Торговые центры'},
        {name:'Отели'}
    ])
    const [tickets, setTickets]=useState([])
    const [fetchTickets, isPostsLoading, postError] = useFetching(async () => {
        const { data: listTickets } = await api.auth.getTickets();
        setTickets(listTickets)
        console.log(tickets)
    })
    useEffect(() => {
        fetchTickets();
    }, []);
    function counterPercent(mas){
        if(mas.length){
            let value=0
            mas.map(el=>{
                if(el.status==="Завершено") value+=1
            })

            return Math.round(value/mas.length*100)
        } else return 0
    }
    function counterSuccessTickets(mas){
        let value=0
        mas.map(el=>{
            if(el.status==="Завершено") value+=1
        })
        return value
    }
    return (
        <div className={cl.container}>
            <div className={cl.headerWrapper}>
                <div className={cl.headerParts}>
                    {
                        titles.map(el=>
                            <div className={el.name==='Все заявки'?cl.headerPartActive:cl.headerPart}  key={el.name}>{el.name}</div>
                        )
                    }
                </div>
                <div className={cl.headerOptions}>
                    <div className={cl.addNewRequest}>
                        <div className={cl.addNewRequest__icon}>
                            <svg width="20" height="21" viewBox="0 0 20 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M10.625 4.875C10.625 4.52982 10.3452 4.25 10 4.25C9.65482 4.25 9.375 4.52982 9.375 4.875V9.875H4.375C4.02982 9.875 3.75 10.1548 3.75 10.5C3.75 10.8452 4.02982 11.125 4.375 11.125H9.375V16.125C9.375 16.4702 9.65482 16.75 10 16.75C10.3452 16.75 10.625 16.4702 10.625 16.125V11.125H15.625C15.9702 11.125 16.25 10.8452 16.25 10.5C16.25 10.1548 15.9702 9.875 15.625 9.875H10.625V4.875Z" fill="black" fillOpacity="0.4"/>
                            </svg>
                        </div>
                        <div className={cl.addNewRequest__text}>Новая заявка</div>
                    </div>
                    <div className={cl.newClient}>Новый клиент</div>
                    <div className={cl.headerDots}>
                        <svg width="28" height="29" viewBox="0 0 28 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 13.25C9.69036 13.25 10.25 13.8096 10.25 14.5C10.25 15.1904 9.69036 15.75 9 15.75C8.30964 15.75 7.75 15.1904 7.75 14.5C7.75 13.8096 8.30964 13.25 9 13.25Z" fill="black" fillOpacity="0.4"/>
                            <path d="M14 13.25C14.6904 13.25 15.25 13.8096 15.25 14.5C15.25 15.1904 14.6904 15.75 14 15.75C13.3096 15.75 12.75 15.1904 12.75 14.5C12.75 13.8096 13.3096 13.25 14 13.25Z" fill="black" fillOpacity="0.4"/>
                            <path d="M20.25 14.5C20.25 13.8096 19.6904 13.25 19 13.25C18.3096 13.25 17.75 13.8096 17.75 14.5C17.75 15.1904 18.3096 15.75 19 15.75C19.6904 15.75 20.25 15.1904 20.25 14.5Z" fill="black" fillOpacity="0.4"/>
                        </svg>
                    </div>
                </div>
            </div>
            <div className={cl.selectPeriod}>
                <div className={cl.selectPeriod__description}>Все заявки за <span>февраль</span></div>
                <div className={cl.selectPeriod__icon}>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fillRule="evenodd" clipRule="evenodd" d="M13.5669 7.68306C13.811 7.92714 13.811 8.32286 13.5669 8.56694L10.4419 11.6919C10.1979 11.936 9.80214 11.936 9.55806 11.6919L6.43306 8.56694C6.18898 8.32286 6.18898 7.92714 6.43306 7.68306C6.67714 7.43898 7.07286 7.43898 7.31694 7.68306L10 10.3661L12.6831 7.68306C12.9271 7.43898 13.3229 7.43898 13.5669 7.68306Z" fill="url(#paint0_linear_2277_3316)"/>
                        <defs>
                            <linearGradient id="paint0_linear_2277_3316" x1="7.65625" y1="11.7" x2="9.05289" y2="6.80422" gradientUnits="userSpaceOnUse">
                                <stop stopColor="#303CB2"/>
                                <stop offset="0.5" stopColor="#0088D5"/>
                                <stop offset="1" stopColor="#64C3D7"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
            </div>
            <div className={cl.statisticRequest}>
                <div className={cl.statisticRequest__el}>
                    <div className={cl.statisticRequest__el_title}>
                        <div className={cl.statisticName}>Всего заявок</div>
                        <div className={cl.statisticIcon}>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3.75 18.75V9.75C3.75 9.33579 3.41421 9 3 9C2.58579 9 2.25 9.33579 2.25 9.75V18.75C2.25 19.3713 2.68934 19.8107 2.68934 19.8107C3.12868 20.25 3.75 20.25 3.75 20.25H20.25C20.8713 20.25 21.3107 19.8107 21.3107 19.8107C21.75 19.3713 21.75 18.75 21.75 18.75V8.25C21.75 7.62868 21.3107 7.18934 21.3107 7.18934C20.8713 6.75 20.25 6.75 20.25 6.75H12C11.5858 6.75 11.25 7.08579 11.25 7.5C11.25 7.91421 11.5858 8.25 12 8.25H20.25V18.75H3.75Z" fill="#1C1C1C"/>
                                <path fillRule="evenodd" clipRule="evenodd" d="M9.6444 10.2018C9.6444 10.2018 9.24649 10.4977 8.7507 10.5L8.74688 10.5H3C2.58579 10.5 2.25 10.1642 2.25 9.75V6C2.25 6 2.25 5.37868 2.68934 4.93934C2.68934 4.93934 3.12868 4.5 3.75 4.5L8.74996 4.50001C8.74996 4.50001 9.24619 4.50205 9.64655 4.79976L12.4497 6.89976C12.5068 6.94253 12.5575 6.99323 12.6002 7.05032C12.7195 7.20951 12.7706 7.40957 12.7424 7.60646C12.7142 7.80336 12.6089 7.98098 12.4497 8.10024L9.6444 10.2018ZM8.74412 9C8.74412 9 8.747 8.9999 8.74935 8.99815L10.7491 7.5L8.7472 6.00024C8.7472 6.00024 8.74687 6.00001 8.74379 5.99999L3.75 6V9H8.74412Z" fill="#1C1C1C"/>
                            </svg>
                        </div>
                    </div>
                    <div className={cl.statisticRequest__el_counter}>3,382</div>
                </div>
                <div className={cl.statisticRequest__el}>
                    <div className={cl.statisticRequest__el_title}>
                        <div className={cl.statisticName}>Текущие заявки/клиенты</div>
                        <div className={cl.statisticIcon}>
                            <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.4167 13.125C16.4167 15.1961 14.7379 16.875 12.6667 16.875C10.5956 16.875 8.91675 15.1961 8.91675 13.125C8.91675 11.0539 10.5956 9.375 12.6667 9.375C14.7379 9.375 16.4167 11.0539 16.4167 13.125Z" fill="black" fillOpacity="0.1"/>
                                <path d="M9.29175 7.875C9.29175 9.53192 7.94867 10.875 6.29175 10.875C4.63483 10.875 3.29175 9.53192 3.29175 7.875C3.29175 6.21808 4.63483 4.875 6.29175 4.875C7.94867 4.875 9.29175 6.21808 9.29175 7.875Z" fill="black" fillOpacity="0.1"/>
                                <path d="M22.0417 7.875C22.0417 9.53192 20.6987 10.875 19.0417 10.875C17.3848 10.875 16.0417 9.53192 16.0417 7.875C16.0417 6.21808 17.3848 4.875 19.0417 4.875C20.6987 4.875 22.0417 6.21808 22.0417 7.875Z" fill="black" fillOpacity="0.1"/>
                                <path fillRule="evenodd" clipRule="evenodd" d="M12.6667 8.625C12.6667 8.625 14.5307 8.625 15.8487 9.94302C15.8487 9.94302 17.1667 11.261 17.1667 13.125C17.1667 13.125 17.1667 14.989 15.8487 16.307C15.8487 16.307 14.5307 17.625 12.6667 17.625C12.6667 17.625 10.8028 17.625 9.48477 16.307C9.48477 16.307 8.16675 14.989 8.16675 13.125C8.16675 13.125 8.16675 11.261 9.48477 9.94302C9.48477 9.94302 10.8028 8.625 12.6667 8.625ZM12.6667 10.125C12.6667 10.125 11.4241 10.125 10.5454 11.0037C10.5454 11.0037 9.66675 11.8824 9.66675 13.125C9.66675 13.125 9.66675 14.3676 10.5454 15.2463C10.5454 15.2463 11.4241 16.125 12.6667 16.125C12.6667 16.125 13.9094 16.125 14.7881 15.2463C14.7881 15.2463 15.6667 14.3676 15.6667 13.125C15.6667 13.125 15.6667 11.8824 14.7881 11.0037C14.7881 11.0037 13.9094 10.125 12.6667 10.125Z" fill="#1C1C1C"/>
                                <path d="M22.9408 13.5737L22.941 13.574C23.0601 13.7333 23.2376 13.8388 23.4345 13.8673C23.47 13.8724 23.5059 13.875 23.5418 13.875L23.5431 13.875C23.7045 13.8747 23.8615 13.8224 23.9908 13.7257C24.1802 13.5842 24.2918 13.3615 24.2918 13.125L24.2917 13.1164C24.2899 12.9575 24.2377 12.8033 24.1425 12.676L24.1419 12.6751C23.2404 11.4694 21.8938 10.796 21.8938 10.796C20.5466 10.1225 19.0405 10.125 19.0405 10.125L19.0418 10.125C19.456 10.125 19.7918 10.4608 19.7918 10.875C19.7918 11.2886 19.457 11.6241 19.0434 11.625L22.9408 13.5737Z" fill="#1C1C1C"/>
                                <path d="M4.11059 12.1377C5.1398 11.6231 6.29049 11.625 6.29049 11.625L6.29154 11.625H6.29175C6.30334 11.625 6.31494 11.6247 6.32652 11.6242C6.51277 11.6155 6.68913 11.5378 6.82119 11.4062C6.96208 11.2658 7.04141 11.0752 7.04175 10.8762L7.04175 10.8752V10.875C7.04175 10.8296 7.03763 10.7844 7.02945 10.7398C6.96426 10.3841 6.65458 10.1256 6.293 10.125L6.29175 10.125C4.78632 10.1228 3.43977 10.796 3.43977 10.796C2.09313 11.4694 1.19164 12.6751 1.19164 12.6751L1.19109 12.6759C1.0941 12.8056 1.04175 12.9631 1.04175 13.125L1.04179 13.1328C1.04214 13.1661 1.0447 13.1994 1.04946 13.2323C1.07792 13.4292 1.18342 13.6067 1.34275 13.7257C1.47239 13.8226 1.6299 13.875 1.79175 13.875C1.80177 13.875 1.8118 13.8748 1.82182 13.8744C2.04759 13.8653 2.25724 13.755 2.3925 13.574C3.08138 12.6523 4.11059 12.1377 4.11059 12.1377Z" fill="#1C1C1C"/>
                                <path d="M15.4529 18.4259C16.7308 19.2241 17.3923 20.5778 17.3923 20.5778L17.3927 20.5786L17.3929 20.5791C17.5187 20.8366 17.7802 21 18.0668 21L18.0874 20.9997C18.1945 20.9968 18.2997 20.9709 18.3959 20.9239C18.6535 20.7982 18.8168 20.5366 18.8168 20.25L18.8166 20.2295C18.8136 20.1224 18.7878 20.0172 18.7408 19.9209L18.7405 19.9203C17.8904 18.1798 16.2475 17.1537 16.2475 17.1537C14.6042 16.1274 12.6668 16.1274 12.6668 16.1274C10.7295 16.1274 9.08622 17.1537 9.08622 17.1537C7.44326 18.1798 6.59319 19.9203 6.59319 19.9203L6.59293 19.9208C6.54286 20.0234 6.51685 20.1359 6.51685 20.25L6.51691 20.2598C6.51795 20.3395 6.53168 20.4185 6.5576 20.4939C6.62227 20.682 6.75902 20.8367 6.93776 20.9239C7.04025 20.974 7.1528 21 7.26685 21L7.28407 20.9998C7.56441 20.9934 7.81775 20.8311 7.94079 20.5791C8.60223 19.2245 9.88081 18.4259 9.88081 18.4259C11.1594 17.6274 12.6668 17.6274 12.6668 17.6274C14.1743 17.6274 15.4529 18.4259 15.4529 18.4259Z" fill="#1C1C1C"/>
                                <path d="M7.92865 6.33439C8.37633 6.8109 8.49892 7.45312 8.49892 7.45312C8.53622 7.64851 8.6496 7.82107 8.81413 7.93286C8.93846 8.01733 9.08531 8.0625 9.23562 8.0625L9.24048 8.06248C9.28605 8.06219 9.33149 8.05774 9.37625 8.0492C9.72985 7.9817 9.98562 7.67248 9.98562 7.3125L9.98561 7.30827C9.98535 7.26249 9.9809 7.21684 9.97232 7.17187C9.768 6.1015 9.02186 5.30731 9.02186 5.30731C8.27572 4.51312 7.22016 4.24249 7.22016 4.24249C6.1646 3.97186 5.12838 4.30907 5.12838 4.30907C4.09217 4.64628 3.39804 5.4863 3.39804 5.4863C2.70392 6.32632 2.56808 7.40753 2.56808 7.40753C2.43224 8.48873 2.89699 9.47436 2.89699 9.47436C3.36174 10.46 4.28234 11.043 4.28234 11.043C5.20261 11.6259 6.29187 11.625 6.29187 11.625L6.29263 11.625C6.49154 11.6248 6.68223 11.5456 6.82274 11.4048C6.96306 11.2642 7.04187 11.0736 7.04187 10.875L7.04187 10.8742C7.04145 10.4603 6.70579 10.125 6.29187 10.125L6.29111 10.125C5.63729 10.1257 5.08493 9.77582 5.08493 9.77582C4.53258 9.42599 4.25372 8.83461 4.25372 8.83461C3.97487 8.24324 4.05638 7.59452 4.05638 7.59452C4.13788 6.94579 4.55436 6.44178 4.55436 6.44178C4.97083 5.93776 5.59256 5.73544 5.59256 5.73544C6.21429 5.53311 6.84763 5.69549 6.84763 5.69549C7.48096 5.85787 7.92865 6.33439 7.92865 6.33439Z" fill="#1C1C1C"/>
                                <path d="M20.2486 9.77582C19.6962 10.1257 19.0424 10.125 19.0424 10.125L19.0417 10.125C19.0299 10.125 19.0181 10.1253 19.0064 10.1258L18.2925 10.9103C18.3012 11.0965 18.3791 11.2728 18.5108 11.4048C18.6513 11.5456 18.842 11.6248 19.0409 11.625L19.0417 11.625C20.1309 11.6259 21.0512 11.043 21.0512 11.043C21.9718 10.46 22.4365 9.47436 22.4365 9.47436C22.9013 8.48873 22.7654 7.40753 22.7654 7.40753C22.6296 6.32632 21.9355 5.4863 21.9355 5.4863C21.2413 4.64628 20.2051 4.30907 20.2051 4.30907C19.1689 3.97186 18.1134 4.24249 18.1134 4.24249C17.0578 4.51312 16.3117 5.30731 16.3117 5.30731C15.5655 6.10149 15.3612 7.17187 15.3612 7.17187C15.3524 7.21822 15.3479 7.26531 15.3479 7.3125C15.3479 7.33503 15.3489 7.35756 15.3509 7.38001C15.3811 7.71338 15.6285 7.98643 15.9573 8.0492C16.0036 8.05804 16.0507 8.0625 16.0979 8.0625C16.1204 8.0625 16.143 8.06148 16.1654 8.05945C16.4988 8.02932 16.7718 7.78192 16.8346 7.45312C16.9572 6.8109 17.4049 6.33439 17.4049 6.33439C17.8526 5.85787 18.4859 5.69549 18.4859 5.69549C19.1192 5.53311 19.741 5.73544 19.741 5.73544C20.3627 5.93776 20.7792 6.44178 20.7792 6.44178C21.1956 6.94579 21.2771 7.59452 21.2771 7.59452C21.3586 8.24324 21.0798 8.83461 21.0798 8.83461C20.8009 9.42599 20.2486 9.77582 20.2486 9.77582Z" fill="#1C1C1C"/>
                            </svg>
                        </div>
                    </div>
                    <div className={cl.statisticRequest__el_counter}>753 / 72</div>
                </div>
                <div className={cl.statisticRequest__el}>
                    <div className={cl.statisticRequest__el_title}>
                        <div className={cl.statisticName}>Снято с активных</div>
                        <div className={cl.statisticIcon}>
                            <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20.5833 4.5H4.08325C3.66904 4.5 3.33325 4.83579 3.33325 5.25C3.33325 5.66421 3.66904 6 4.08325 6H20.5833C20.9975 6 21.3333 5.66421 21.3333 5.25C21.3333 4.83579 20.9975 4.5 20.5833 4.5Z" fill="#1C1C1C"/>
                                <path d="M9.33325 9.75V15.75C9.33325 16.1642 9.66904 16.5 10.0833 16.5C10.4975 16.5 10.8333 16.1642 10.8333 15.75V9.75C10.8333 9.33579 10.4975 9 10.0833 9C9.66904 9 9.33325 9.33579 9.33325 9.75Z" fill="#1C1C1C"/>
                                <path d="M13.8333 9.75V15.75C13.8333 16.1642 14.169 16.5 14.5833 16.5C14.9975 16.5 15.3333 16.1642 15.3333 15.75V9.75C15.3333 9.33579 14.9975 9 14.5833 9C14.169 9 13.8333 9.33579 13.8333 9.75Z" fill="#1C1C1C"/>
                                <path d="M6.33325 19.5V5.25C6.33325 4.83579 5.99747 4.5 5.58325 4.5C5.16904 4.5 4.83325 4.83579 4.83325 5.25V19.5C4.83325 20.1213 5.27259 20.5607 5.27259 20.5607C5.71193 21 6.33325 21 6.33325 21H18.3333C18.9546 21 19.3939 20.5607 19.3939 20.5607C19.8333 20.1213 19.8333 19.5 19.8333 19.5V5.25C19.8333 4.83579 19.4975 4.5 19.0833 4.5C18.669 4.5 18.3333 4.83579 18.3333 5.25V19.5H6.33325Z" fill="#1C1C1C"/>
                                <path d="M8.49226 2.15901C7.83325 2.81802 7.83325 3.75 7.83325 3.75V5.25C7.83325 5.66421 8.16904 6 8.58325 6C8.99747 6 9.33325 5.66421 9.33325 5.25V3.75C9.33325 3.43934 9.55292 3.21967 9.55292 3.21967C9.77259 3 10.0833 3 10.0833 3H14.5833C14.8939 3 15.1136 3.21967 15.1136 3.21967C15.3333 3.43934 15.3333 3.75 15.3333 3.75V5.25C15.3333 5.66421 15.669 6 16.0833 6C16.4975 6 16.8333 5.66421 16.8333 5.25V3.75C16.8333 2.81802 16.1742 2.15901 16.1742 2.15901C15.5152 1.5 14.5833 1.5 14.5833 1.5H10.0833C9.15127 1.5 8.49226 2.15901 8.49226 2.15901Z" fill="#1C1C1C"/>
                            </svg>
                        </div>
                    </div>
                    <div className={cl.statisticRequest__el_counter}>32</div>
                </div>


            </div>
            <div className={cl.RequestsLits}>
                {tickets.map(el=>
                    <div key={el.id} className={cl.RequestEl}>
                        <div className={cl.RequestEl__header}>
                            <div className={cl.RequestEl__header_left}>
                                <div className={cl.RequestElHeaderTitle}>{el.title}</div>
                                <div className={cl.RequestElHeaderDate}>Заявка от {el.created.slice(0,10)}</div>
                            </div>
                            <div className={cl.RequestEl__header_right}><img src={Builders}/></div>
                        </div>
                        <div className={cl.RequestEl__status}>
                            <div className={cl.RequestEl__status_avatar}>
                                <div className={cl.statusRequestIcon}><img src={AvatarRequest}/></div>
                                <div className={cl.statusRequestName}>{el.owner.firstname+' '+' '+el.owner.lastname}</div>
                            </div>
                            <div className={cl.RequestEl__status_funnel}>{el.status}</div>
                        </div>
                        <div className={cl.RequestEl__range}>
                            <input readOnly type="range" value={counterPercent(el.tasks)}/>
                        </div>
                        <div className={cl.RequestEl__counter}>
                            <div>{counterSuccessTickets(el.tasks)} / {el.tasks.length?el.tasks.length:'?'} Всего подзадач</div>
                            <div>{counterPercent(el.tasks)}%</div>
                        </div>
                    </div>
                )}
            </div>
        </div>
    );
};

export default AllRequests;